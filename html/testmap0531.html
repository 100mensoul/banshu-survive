<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>福本不動産 - ヒメモリの地マップ 2.0</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-left h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .header-left p {
            color: #64748b;
            font-size: 1.1rem;
            font-weight: 400;
        }

        .header-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            min-width: 100px;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 0.2rem;
        }

        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            height: calc(100vh - 200px);
        }

        .map-wrapper {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            background: white;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .map-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .filter-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-btn.active {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .filter-all { background: #f1f5f9; color: #334155; }
        .filter-all.active { background: #334155; color: white; }

        .filter-apartment { background: #fef2f2; color: #dc2626; }
        .filter-apartment.active { background: #dc2626; color: white; }

        .filter-tenant { background: #fffbeb; color: #d97706; }
        .filter-tenant.active { background: #d97706; color: white; }

        .filter-land { background: #f0fdf4; color: #16a34a; }
        .filter-land.active { background: #16a34a; color: white; }

        .filter-development { background: #faf5ff; color: #9333ea; }
        .filter-development.active { background: #9333ea; color: white; }

        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow-y: auto;
            height: fit-content;
            max-height: 100%;
        }

        .sidebar h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .property-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .property-card {
            padding: 1.5rem;
            border-radius: 15px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .property-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            transition: all 0.3s ease;
        }

        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .property-card.apartment {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
        }
        .property-card.apartment::before { background: #dc2626; }

        .property-card.tenant {
            background: linear-gradient(135deg, #fffbeb 0%, #fed7aa 100%);
        }
        .property-card.tenant::before { background: #d97706; }

        .property-card.land {
            background: linear-gradient(135deg, #f0fdf4 0%, #bbf7d0 100%);
        }
        .property-card.land::before { background: #16a34a; }

        .property-card.development {
            background: linear-gradient(135deg, #faf5ff 0%, #e9d5ff 100%);
        }
        .property-card.development::before { background: #9333ea; }

        .property-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .property-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            line-height: 1.3;
        }

        .property-icon {
            font-size: 1.5rem;
            opacity: 0.8;
        }

        .property-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin: 8px 0;
        }

        .status-active {
            background: #dcfce7;
            color: #166534;
        }

        .status-planned {
            background: #fef3c7;
            color: #92400e;
        }

        .status-vacant {
            background: #f1f5f9;
            color: #475569;
        }

        .property-description {
            font-size: 0.9rem;
            color: #64748b;
            line-height: 1.5;
        }

        .priority-badge {
            background: linear-gradient(45deg, #f59e0b, #d97706);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-block;
            margin-top: 8px;
        }

        .development-info {
            background: rgba(147, 51, 234, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border-left: 4px solid #9333ea;
        }

        .development-info h3 {
            color: #9333ea;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(147, 51, 234, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9333ea, #c084fc);
            border-radius: 4px;
            transition: width 0.8s ease;
        }

        .custom-popup .leaflet-popup-content-wrapper {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            border: none;
        }

        .custom-popup .leaflet-popup-content {
            margin: 25px;
            font-size: 14px;
            line-height: 1.6;
            width: 320px !important;
        }

        .custom-popup .leaflet-popup-tip {
            background: #667eea;
            box-shadow: none;
        }

        .popup-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .popup-icon {
            font-size: 2rem;
            opacity: 0.9;
        }

        .popup-title {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .popup-details {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .popup-detail-item {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .popup-detail-label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .popup-detail-value {
            font-weight: 500;
        }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr auto;
                height: auto;
            }
            
            .map-wrapper {
                height: 60vh;
                min-height: 500px;
            }

            .sidebar {
                height: auto;
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .header-left h1 {
                font-size: 2rem;
            }

            .header-stats {
                justify-content: center;
                flex-wrap: wrap;
            }

            .main-container {
                padding: 0 1rem;
                gap: 1rem;
            }

            .map-controls {
                position: relative;
                top: 0;
                left: 0;
                margin-bottom: 1rem;
            }

            .control-group {
                margin-bottom: 1rem;
            }

            .filter-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            border-radius: 20px;
        }

        .loading-content {
            text-align: center;
            color: #667eea;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.8s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="header fade-in">
        <div class="header-content">
            <div class="header-left">
                <h1>福本不動産</h1>
                <p>ヒメモリの地 - 総合開発マップ</p>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-number">7</div>
                    <div class="stat-label">物件数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">3</div>
                    <div class="stat-label">進行中</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">50+</div>
                    <div class="stat-label">管理年数</div>
                </div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="map-wrapper fade-in">
            <div class="loading-overlay" id="loading">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <div>マップを読み込み中...</div>
                </div>
            </div>
            
            <div class="map-controls">
                <div class="control-group">
                    <div class="filter-buttons">
                        <button class="filter-btn filter-all active" data-filter="all">
                            <i class="fas fa-globe"></i> すべて表示
                        </button>
                        <button class="filter-btn filter-apartment" data-filter="apartment">
                            <i class="fas fa-building"></i> アパート
                        </button>
                        <button class="filter-btn filter-tenant" data-filter="tenant">
                            <i class="fas fa-store"></i> テナント
                        </button>
                        <button class="filter-btn filter-land" data-filter="land">
                            <i class="fas fa-seedling"></i> 農地
                        </button>
                        <button class="filter-btn filter-development" data-filter="development">
                            <i class="fas fa-hammer"></i> 開発予定
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="map"></div>
        </div>

        <div class="sidebar fade-in">
            <h2><i class="fas fa-map-marked-alt"></i> 物件一覧</h2>
            
            <div class="property-list" id="propertyList">
                <!-- 物件カードはJavaScriptで動的生成 -->
            </div>

            <div class="development-info">
                <h3><i class="fas fa-chart-line"></i> 主要プロジェクト進捗</h3>
                <div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>ツインピークス改築</span>
                        <span>85%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%"></div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>道の駅建設</span>
                        <span>45%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 45%"></div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>上原田土地開発</span>
                        <span>90%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 90%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // グローバル変数
        let map;
        let markers = [];
        let currentFilter = 'all';

        // 物件データ（手描き地図を参考に正確な位置関係で配置）
        const properties = [
            {
                id: 1,
                name: 'ツインピークス',
                subname: '福本荘・福寿荘',
                type: 'apartment',
                position: [320, 280],
                status: 'planned',
                priority: true,
                icon: 'fas fa-building',
                details: {
                    '概要': '2棟からなるアパート複合施設',
                    '居住状況': '現在2組が居住中',
                    '状態': '老朽化により改築が必要',
                    '計画': '建築士と改築計画を策定中',
                    '優先度': '最優先プロジェクト',
                    '予算': '確保次第着工予定'
                }
            },
            {
                id: 2,
                name: '野路菊',
                subname: 'アパート2',
                type: 'apartment',
                position: [250, 380],
                status: 'vacant',
                priority: false,
                icon: 'fas fa-building',
                details: {
                    '概要': '立地の難しい場所にあるアパート',
                    '状態': '現在空室',
                    '立地': '入り組んだ場所で利用が困難',
                    '計画': '特に活用予定なし',
                    '課題': 'アクセス改善が必要'
                }
            },
            {
                id: 3,
                name: '旧サムエ',
                subname: 'テナント1',
                type: 'tenant',
                position: [380, 240],
                status: 'planned',
                priority: false,
                icon: 'fas fa-cut',
                details: {
                    '概要': '新規美容院開業予定のテナント',
                    '現状': '現在空きテナント',
                    '計画': '美容院の新規入居が決定',
                    '進捗': '契約手続き中',
                    '開業予定': '2025年夏頃',
                    '期待': '地域の美容サービス向上'
                }
            },
            {
                id: 4,
                name: 'アローム',
                subname: 'テナント2',
                type: 'tenant',
                position: [300, 340],
                status: 'active',
                priority: false,
                icon: 'fas fa-utensils',
                details: {
                    '概要': '就労事業所として運営中',
                    '事業内容': 'お弁当屋さんアローム',
                    '運営状況': '現在営業中',
                    '特徴': '地域密着型の就労支援',
                    '評価': '地域から好評',
                    '今後': '事業拡大を検討中'
                }
            },
            {
                id: 5,
                name: '上原田北側',
                subname: '開発予定地A',
                type: 'development',
                position: [450, 200],
                status: 'planned',
                priority: true,
                icon: 'fas fa-industry',
                details: {
                    '場所': '県道372号線北側・上原田交差点東側',
                    '現在の用途': '農業用地（田んぼ）',
                    '状況': '関東の工場企業と交渉中',
                    '進捗': '約8-9割話がまとまっている',
                    '仲介': '有馬不動産が担当',
                    '備考': 'ローソン隣接地'
                }
            },
            {
                id: 6,
                name: '上原田南側',
                subname: '農業用地',
                type: 'land',
                position: [450, 300],
                status: 'active',
                priority: false,
                icon: 'fas fa-seedling',
                details: {
                    '場所': '県道372号線南側の農業用地',
                    '現在の用途': '田んぼ（今年も田植え実施）',
                    '所有形態': '13家庭による共同所有',
                    '取引条件': '8割が貸与、2割が売却',
                    '交渉状況': 'ダイワハウス・京都の不動産会社と交渉中',
                    '今後': '段階的な開発を予定'
                }
            },
            {
                id: 7,
                name: '道の駅',
                subname: '建設予定地',
                type: 'development',
                position: [550, 260],
                status: 'planned',
                priority: true,
                icon: 'fas fa-gas-pump',
                details: {
                    '場所': '花田IC東側・天川沿いの敷地',
                    '状況': '姫路市が土地購入済み',
                    'スケジュール': '令和7年7月プロポーザル開始予定',
                    '実施方式': 'DBO方式（民間委託）',
                    '機能': '車両休憩・農作物販売・防災拠点・役所出張機能',
                    '遅延': '当初予定より大幅に遅れている'
                }
            }
        ];

        // 地図の初期化
        function initializeMap() {
            map = L.map('map', {
                crs: L.CRS.Simple,
                minZoom: 0,
                maxZoom: 3,
                center: [350, 400],
                zoom: 1,
                zoomControl: true,
                attributionControl: false
            });

            // 背景のスタイリング
            map.getContainer().style.background = 'linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)';

            // 道路・インフラの描画
            drawInfrastructure();

            // 物件マーカーの作成
            createPropertyMarkers();

            // サイドバーの物件リスト生成
            generatePropertyList();

            // フィルターイベントの設定
            setupFilters();

            // ローディング完了
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 1000);
        }

        // インフラの描画
        function drawInfrastructure() {
            // 県道372号線（メイン道路）
            L.polyline([
                [100, 150], [150, 200], [200, 220], [300, 240], 
                [400, 250], [500, 270], [600, 300]
            ], {
                color: '#fbbf24',
                weight: 12,
                opacity: 0.9,
                lineCap: 'round',
                lineJoin: 'round'
            }).addTo(map).bindTooltip('県道372号線', {
                permanent: false,
                direction: 'top'
            });

            // 天川
            L.polyline([
                [180, 120], [220, 160], [280, 180], [350, 200], 
                [420, 220], [480, 250], [520, 280]
            ], {
                color: '#3b82f6',
                weight: 8,
                opacity: 0.8,
                dashArray: '10, 5',
                lineCap: 'round'
            }).addTo(map).bindTooltip('天川', {
                permanent: false,
                direction: 'top'
            });

            // 補助道路
            const roads = [
                [[120, 180], [400, 320]],
                [[200, 150], [350, 280]],
                [[350, 150], [500, 200]],
                [[400, 180], [600, 350]]
            ];

            roads.forEach(road => {
                L.polyline(road, {
                    color: '#9ca3af',
                    weight: 4,
                    opacity: 0.6,
                    lineCap: 'round'
                }).addTo(map);
            });

            // 上原田交差点
            L.circle([300, 240], {
                radius: 25,
                color: '#ef4444',
                fillColor: '#fef2f2',
                fillOpacity: 0.8,
                weight: 3
            }).addTo(map).bindTooltip('上原田交差点', {
                permanent: false,
                direction: 'top'
            });

            // ランドマーク（ローソン）
            L.marker([280, 200], {
                icon: L.divIcon({
                    html: '<div style="background: #0ea5e9; color: white; padding: 4px 8px; border-radius: 8px; font-size: 10px; font-weight: bold;">LAWSON</div>',
                    className: 'landmark-marker',
                    iconSize: [60, 20],
                    iconAnchor: [30, 10]
                })
            }).addTo(map);
        }

        // カスタムマーカーアイコンの作成
        function createCustomIcon(property) {
            const colors = {
                apartment: '#dc2626',
                tenant: '#d97706',
                land: '#16a34a',
                development: '#9333ea'
            };

            const bgColors = {
                apartment: '#fef2f2',
                tenant: '#fffbeb',
                land: '#f0fdf4',
                development: '#faf5ff'
            };

            const size = property.priority ? 45 : 35;
            const iconSize = property.priority ? '18px' : '14px';

            return L.divIcon({
                html: `
                    <div style="
                        width: ${size}px;
                        height: ${size}px;
                        background: ${bgColors[property.type]};
                        border: 3px solid ${colors[property.type]};
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: ${iconSize};
                        color: ${colors[property.type]};
                        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
                        transition: all 0.3s ease;
                        cursor: pointer;
                        position: relative;
                        ${property.priority ? 'animation: pulse 2s infinite;' : ''}
                    ">
                        <i class="${property.icon}"></i>
                        ${property.priority ? '<div style="position: absolute; top: -5px; right: -5px; width: 12px; height: 12px; background: #f59e0b; border-radius: 50%; border: 2px solid white;"></div>' : ''}
                    </div>
                `,
                className: `custom-marker ${property.type}`,
                iconSize: [size, size],
                iconAnchor: [size/2, size/2]
            });
        }

        // 物件マーカーの作成
        function createPropertyMarkers() {
            properties.forEach(property => {
                const marker = L.marker(property.position, {
                    icon: createCustomIcon(property)
                }).addTo(map);

                marker.propertyData = property;
                markers.push(marker);

                // ポップアップの作成
                const popupContent = createPopupContent(property);
                marker.bindPopup(popupContent, {
                    maxWidth: 350,
                    className: 'custom-popup'
                });

                // ホバー効果
                marker.on('mouseover', function() {
                    this.getElement().style.transform = 'scale(1.2)';
                    this.getElement().style.zIndex = '1000';
                });

                marker.on('mouseout', function() {
                    this.getElement().style.transform = 'scale(1)';
                    this.getElement().style.zIndex = '100';
                });
            });
        }

        // ポップアップコンテンツの作成
        function createPopupContent(property) {
            const statusMap = {
                active: { text: '運営中', class: 'status-active' },
                planned: { text: '計画中', class: 'status-planned' },
                vacant: { text: '空室', class: 'status-vacant' }
            };

            const status = statusMap[property.status];
            
            let detailsHtml = '';
            Object.entries(property.details).forEach(([key, value]) => {
                detailsHtml += `
                    <div class="popup-detail-item">
                        <div class="popup-detail-label">${key}</div>
                        <div class="popup-detail-value">${value}</div>
                    </div>
                `;
            });

            return `
                <div class="popup-header">
                    <i class="${property.icon} popup-icon"></i>
                    <div>
                        <div class="popup-title">${property.name}</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">${property.subname}</div>
                    </div>
                </div>
                <div style="text-align: center; margin-bottom: 15px;">
                    <span class="popup-status ${status.class}">${status.text}</span>
                    ${property.priority ? '<span style="background: #f59e0b; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; margin-left: 8px;">優先</span>' : ''}
                </div>
                <div class="popup-details">
                    ${detailsHtml}
                </div>
            `;
        }

        // サイドバーの物件リスト生成
        function generatePropertyList() {
            const listContainer = document.getElementById('propertyList');
            
            properties.forEach(property => {
                const card = document.createElement('div');
                card.className = `property-card ${property.type}`;
                card.setAttribute('data-property-id', property.id);
                card.setAttribute('data-type', property.type);

                const statusMap = {
                    active: { text: '運営中', class: 'status-active' },
                    planned: { text: '計画中', class: 'status-planned' },
                    vacant: { text: '空室', class: 'status-vacant' }
                };

                const status = statusMap[property.status];

                card.innerHTML = `
                    <div class="property-header">
                        <div>
                            <div class="property-title">${property.name}</div>
                            <div style="font-size: 0.9rem; color: #64748b; margin-top: 2px;">${property.subname}</div>
                        </div>
                        <i class="${property.icon} property-icon"></i>
                    </div>
                    <div class="property-status ${status.class}">${status.text}</div>
                    ${property.priority ? '<div class="priority-badge">優先プロジェクト</div>' : ''}
                    <div class="property-description">
                        ${Object.values(property.details)[0]}
                    </div>
                `;

                // クリックイベント
                card.addEventListener('click', () => {
                    const marker = markers.find(m => m.propertyData.id === property.id);
                    if (marker) {
                        map.setView(marker.getLatLng(), 2);
                        marker.openPopup();
                    }
                });

                listContainer.appendChild(card);
            });
        }

        // フィルター機能の設定
        function setupFilters() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // アクティブ状態の更新
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    // フィルターの適用
                    const filter = button.getAttribute('data-filter');
                    currentFilter = filter;
                    applyFilter(filter);
                });
            });
        }

        // フィルターの適用
        function applyFilter(filter) {
            // マーカーのフィルター
            markers.forEach(marker => {
                const property = marker.propertyData;
                if (filter === 'all' || property.type === filter) {
                    marker.addTo(map);
                } else {
                    map.removeLayer(marker);
                }
            });

            // サイドバーのフィルター
            const propertyCards = document.querySelectorAll('.property-card');
            propertyCards.forEach(card => {
                const type = card.getAttribute('data-type');
                if (filter === 'all' || type === filter) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // CSS keyframes for pulse animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);

        // 地図の初期化実行
        document.addEventListener('DOMContentLoaded', initializeMap);

        console.log('福本不動産マップ 2.0 が正常に読み込まれました');
    </script>
</body>
</html>
