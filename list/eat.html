<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŸã¹ã‚‹ãŸã‚ã«ã€ç”Ÿãã¦ã„ã‚‹ - å§«è·¯ã‚°ãƒ«ãƒ¡ãƒãƒ¼ã‚¿ãƒ«</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Noto+Serif+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #faf8f6 0%, #f0ede8 100%);
            min-height: 100vh;
            color: #3a3a3a;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.9);
            padding: 60px 40px;
            border-radius: 24px;
            text-align: center;
            margin-bottom: 40px;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 40px rgba(58, 58, 58, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.9);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(218, 165, 32, 0.1) 0%, transparent 70%);
            animation: shimmer 6s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.3; transform: rotate(0deg); }
            50% { opacity: 0.6; transform: rotate(180deg); }
        }

        .header h1 {
            font-family: 'Noto Serif JP', serif;
            font-size: 3.5rem;
            color: #8B4513;
            margin-bottom: 16px;
            font-weight: 500;
            letter-spacing: 0.05em;
            position: relative;
            z-index: 2;
        }

        .header .subtitle {
            font-family: 'Noto Serif JP', serif;
            font-size: 1.2rem;
            color: #DAA520;
            margin-bottom: 20px;
            font-weight: 300;
            position: relative;
            z-index: 2;
        }

        .header .description {
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 1rem;
            color: #666;
            margin-bottom: 20px;
            font-weight: 400;
            position: relative;
            z-index: 2;
            line-height: 1.7;
        }

        .controls {
            background: rgba(255, 255, 255, 0.9);
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 40px;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 40px rgba(58, 58, 58, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.9);
        }

        .search-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 500;
            margin-bottom: 12px;
            color: #8B4513;
            font-size: 0.95rem;
        }

        .filter-group select,
        .filter-group input {
            padding: 16px 20px;
            border: 2px solid #e6ddd4;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafaf8;
            color: #3a3a3a;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #DAA520;
            box-shadow: 0 0 0 4px rgba(218, 165, 32, 0.1);
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #DAA520, #B8860B);
            color: white;
            box-shadow: 0 4px 16px rgba(218, 165, 32, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #B8860B, #DAA520);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(218, 165, 32, 0.4);
        }

        .btn-secondary {
            background: #f5f1eb;
            color: #8B4513;
            border: 2px solid #e6ddd4;
        }

        .btn-secondary:hover {
            background: #e6ddd4;
            transform: translateY(-2px);
        }

        .view-toggle {
            display: flex;
            background: #f5f1eb;
            border-radius: 12px;
            padding: 4px;
            gap: 4px;
        }

        .view-toggle button {
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            color: #8B4513;
            font-weight: 400;
        }

        .view-toggle button.active {
            background: #DAA520;
            color: white;
            box-shadow: 0 2px 8px rgba(218, 165, 32, 0.3);
        }

        .stats {
            background: rgba(255, 255, 255, 0.9);
            padding: 32px;
            border-radius: 20px;
            margin-bottom: 40px;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 40px rgba(58, 58, 58, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.9);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 32px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #fafaf8, #f5f1eb);
            border-radius: 16px;
            border: 1px solid rgba(218, 165, 32, 0.2);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 300;
            color: #DAA520;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #8B4513;
            font-size: 0.9rem;
            font-weight: 400;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 32px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 32px;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 40px rgba(58, 58, 58, 0.08);
            transition: all 0.4s ease;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.9);
            overflow: hidden;
        }

        .card.closed {
            opacity: 0.6;
            background: rgba(100, 100, 100, 0.1);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 60px rgba(58, 58, 58, 0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 500;
            color: #8B4513;
            margin-bottom: 8px;
            letter-spacing: 0.01em;
        }

        .card-address {
            color: #666;
            font-size: 0.9rem;
            font-weight: 400;
        }

        .card-type {
            background: linear-gradient(135deg, #DAA520, #B8860B);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(218, 165, 32, 0.3);
        }

        .card-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 28px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 400;
        }

        .info-value {
            font-weight: 500;
            color: #3a3a3a;
            font-size: 0.95rem;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .tag {
            background: rgba(218, 165, 32, 0.1);
            color: #8B4513;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 400;
        }

        .card-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e6ddd4;
        }

        .btn-small {
            padding: 12px 24px;
            font-size: 0.9rem;
        }

        .photo-upload {
            margin-top: 16px;
            padding: 16px;
            border: 2px dashed #DAA520;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-upload:hover {
            background: rgba(218, 165, 32, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(58, 58, 58, 0.7);
            backdrop-filter: blur(8px);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 80px rgba(58, 58, 58, 0.15);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e6ddd4;
        }

        .modal-header h2 {
            font-size: 1.6rem;
            color: #8B4513;
            font-weight: 500;
        }

        .close {
            font-size: 28px;
            cursor: pointer;
            color: #666;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #8B4513;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
        }

        .detail-section {
            background: #fafaf8;
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(218, 165, 32, 0.2);
        }

        .detail-section h3 {
            color: #8B4513;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .detail-section .info-item {
            margin-bottom: 16px;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .photo-item {
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 0.9rem;
        }

        .list-view {
            display: none;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            overflow: hidden;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 40px rgba(58, 58, 58, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.9);
        }

        .list-view table {
            width: 100%;
            border-collapse: collapse;
        }

        .list-view th,
        .list-view td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid #e6ddd4;
        }

        .list-view th {
            background: #f5f1eb;
            font-weight: 500;
            color: #8B4513;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            .header {
                padding: 40px 24px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .search-filters {
                grid-template-columns: 1fr;
            }
            
            .gallery {
                grid-template-columns: 1fr;
            }
            
            .card-info {
                grid-template-columns: 1fr;
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ãŸã¹ã‚‹ãŸã‚ã«ã€ç”Ÿãã¦ã„ã‚‹</h1>
            <div class="subtitle">ä¸–ç•Œã‚’å‘³ã‚ã†ãŸã‚ã«</div>
            <div class="description">æ–™ç†ã‚’é€šã—ã¦é£Ÿæã¨å‡ºä¼šã„ã€å¤§åœ°ã«æƒ³ã„ã‚’é¦³ã›ã‚‹ã‚°ãƒ«ãƒ¡ã‚¬ã‚¤ãƒ‰</div>
        </div>

        <div class="controls">
            <div class="search-filters">
                <div class="filter-group">
                    <label for="cuisineFilter">æ–™ç†ã‚¸ãƒ£ãƒ³ãƒ«</label>
                    <select id="cuisineFilter">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="ç´”å’Œé£Ÿ">ç´”å’Œé£Ÿ</option>
                        <option value="å’Œé£Ÿ">å’Œé£Ÿ</option>
                        <option value="æ´‹é£Ÿ">æ´‹é£Ÿ</option>
                        <option value="ä¸­è¯">ä¸­è¯</option>
                        <option value="ã‚¢ã‚¸ã‚¢æ–™ç†">ã‚¢ã‚¸ã‚¢æ–™ç†</option>
                        <option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="priceFilter">é‡‘é¡å¸¯</label>
                    <select id="priceFilter">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="~5000">ã€œ5,000å††</option>
                        <option value="5000-10000">5,000ã€œ10,000å††</option>
                        <option value="10000+">10,000å††ã€œ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="volumeFilter">é‡</label>
                    <select id="volumeFilter">
                        <option value="">ã™ã¹ã¦</option>
                        <option value="è»½ã‚">è»½ã‚</option>
                        <option value="ã—ã£ã‹ã‚Š">ã—ã£ã‹ã‚Š</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchInput">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢</label>
                    <input type="text" id="searchInput" placeholder="åº—åã€æ–™ç†åã§æ¤œç´¢">
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="addNewRestaurantAuto()">ğŸ“ æ–°åº—èˆ—ã‚’è‡ªå‹•è¿½åŠ </button>
                <button class="btn btn-secondary" onclick="updateAllBusinessHours()">ğŸ”„ å–¶æ¥­æ™‚é–“ã‚’ä¸€æ‹¬æ›´æ–°</button>
                <button class="btn btn-secondary" onclick="exportVisited()">è¡Œã£ãŸåº—ãƒªã‚¹ãƒˆã‚’CSVå‡ºåŠ›</button>
                <button class="btn btn-secondary" onclick="clearVisited()">è¨˜éŒ²ã‚¯ãƒªã‚¢</button>
                <div class="view-toggle">
                    <button class="active" id="galleryBtn" onclick="setView('gallery')">ã‚«ãƒ¼ãƒ‰</button>
                    <button id="listBtn" onclick="setView('list')">ãƒªã‚¹ãƒˆ</button>
                </div>
            </div>
        </div>

        <div class="gallery" id="gallery">
            <!-- ã‚«ãƒ¼ãƒ‰ã¯JavaScriptã§å‹•çš„ç”Ÿæˆ -->
        </div>

        <!-- ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ -->
        <div class="list-view" id="listView">
            <table>
                <thead>
                    <tr>
                        <th>åº—å</th>
                        <th>ã‚¸ãƒ£ãƒ³ãƒ«</th>
                        <th>é‡‘é¡å¸¯</th>
                        <th>ã‚¢ã‚¯ã‚»ã‚¹</th>
                        <th>å–¶æ¥­æ™‚é–“</th>
                        <th>é§è»Šå ´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="listTableBody">
                    <!-- ãƒ‡ãƒ¼ã‚¿ã¯JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">è©³ç´°æƒ…å ±</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div id="modalBody">
                <!-- è©³ç´°æƒ…å ±ã¯JavaScriptã§å‹•çš„ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- å†™çœŸæŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="photoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>å†™çœŸã‚’æŠ•ç¨¿</h2>
                <span class="close" onclick="closePhotoModal()">&times;</span>
            </div>
            <div class="photo-upload" onclick="uploadPhoto()">
                <p>ğŸ“¸ å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</p>
                <p style="font-size: 0.9rem; color: #666; margin-top: 8px;">ã‚¯ãƒªãƒƒã‚¯ã—ã¦å†™çœŸã‚’é¸æŠ</p>
            </div>
            <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    <script>
        // Google Places API (New) è¨­å®š
        const GOOGLE_PLACES_API_KEY = 'YOUR_API_KEY_HERE'; // å®Ÿéš›ã®APIã‚­ãƒ¼ã«ç½®ãæ›ãˆã¦ãã ã•ã„
        const PLACES_API_BASE_URL = 'https://places.googleapis.com/v1';
        
        // åº—èˆ—è‡ªå‹•æ¤œç´¢ãƒ»æƒ…å ±å–å¾—æ©Ÿèƒ½ (New Places APIå¯¾å¿œ)
        async function searchAndFetchPlaceInfo(query, location = 'å§«è·¯å¸‚') {
            try {
                const searchQuery = `${query} ${location}`;
                
                // New Places API ã®Text Search (Search Text)ã‚’ä½¿ç”¨
                const searchData = {
                    textQuery: searchQuery,
                    languageCode: 'ja',
                    regionCode: 'JP',
                    maxResultCount: 5
                };
                
                // CORSåˆ¶é™ã®ãŸã‚ã€å®Ÿéš›ã®å®Ÿè£…ã§ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚’çµŒç”±ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
                const response = await fetch('/api/places/searchText', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        searchData: searchData,
                        apiKey: GOOGLE_PLACES_API_KEY
                    })
                });
                
                const data = await response.json();
                
                if (data.places && data.places.length > 0) {
                    const place = data.places[0];
                    
                    // è©³ç´°æƒ…å ±ã‚’å–å¾—
                    const details = await getPlaceDetailsNew(place.id);
                    return formatPlaceDataNew(details);
                } else {
                    throw new Error('åº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                }
                
            } catch (error) {
                console.error('åº—èˆ—æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                alert('åº—èˆ—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                return null;
            }
        }
        
        // New Places API ã§è©³ç´°æƒ…å ±ã‚’å–å¾—
        async function getPlaceDetailsNew(placeId) {
            const fieldMask = [
                'id',
                'displayName',
                'formattedAddress',
                'nationalPhoneNumber',
                'regularOpeningHours',
                'websiteUri',
                'googleMapsUri',
                'rating',
                'priceLevel',
                'photos',
                'paymentOptions',
                'wheelchairAccessibleEntrance',
                'allowsDogs',
                'currentOpeningHours'
            ].join(',');
            
            const response = await fetch(`/api/places/details`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    placeId: placeId,
                    fieldMask: fieldMask,
                    apiKey: GOOGLE_PLACES_API_KEY
                })
            });
            
            const data = await response.json();
            return data;
        }
        
        // New Places API ã®ãƒ‡ãƒ¼ã‚¿ã‚’å†…éƒ¨å½¢å¼ã«å¤‰æ›
        function formatPlaceDataNew(placeDetails) {
            const openingHours = placeDetails.regularOpeningHours || placeDetails.currentOpeningHours;
            const photos = placeDetails.photos || [];
            
            return {
                name: placeDetails.displayName?.text || placeDetails.displayName,
                address: placeDetails.formattedAddress,
                phone: placeDetails.nationalPhoneNumber || '',
                website: placeDetails.websiteUri || '',
                googleMaps: placeDetails.googleMapsUri || '',
                rating: placeDetails.rating || 0,
                priceLevel: placeDetails.priceLevel || 'PRICE_LEVEL_UNSPECIFIED',
                hours: formatOpeningHoursNew(openingHours),
                photos: photos.slice(0, 5).map(photo => 
                    `${PLACES_API_BASE_URL}/places/${placeDetails.id}/photos/${photo.name}/media?key=${GOOGLE_PLACES_API_KEY}&maxWidthPx=400`
                ),
                isOpen: checkIfOpen(openingHours),
                // æ–°æ©Ÿèƒ½
                wheelchairAccessible: placeDetails.wheelchairAccessibleEntrance || false,
                allowsDogs: placeDetails.allowsDogs || false,
                paymentOptions: placeDetails.paymentOptions || {}
            };
        }
        
        // å–¶æ¥­æ™‚é–“ã®æ•´å½¢ (New APIå¯¾å¿œ)
        function formatOpeningHoursNew(openingHours) {
            if (!openingHours || !openingHours.weekdayDescriptions) {
                return 'å–¶æ¥­æ™‚é–“ä¸æ˜';
            }
            
            // ä»Šæ—¥ã®å–¶æ¥­æ™‚é–“ã‚’å–å¾—
            const today = new Date().getDay();
            const todayIndex = today === 0 ? 6 : today - 1; // æ—¥æ›œæ—¥=0ã‚’6ã«å¤‰æ›
            
            if (openingHours.weekdayDescriptions[todayIndex]) {
                return openingHours.weekdayDescriptions[todayIndex].replace(/^[^\s]+\s/, ''); // æ›œæ—¥éƒ¨åˆ†ã‚’å‰Šé™¤
            }
            
            return openingHours.weekdayDescriptions[0] || 'å–¶æ¥­æ™‚é–“ä¸æ˜';
        }
        
        // ç¾åœ¨å–¶æ¥­ä¸­ã‹ãƒã‚§ãƒƒã‚¯
        function checkIfOpen(openingHours) {
            if (!openingHours || !openingHours.periods) {
                return true; // ä¸æ˜ãªå ´åˆã¯å–¶æ¥­ä¸­ã¨ã™ã‚‹
            }
            
            const now = new Date();
            const currentDay = now.getDay();
            const currentTime = now.getHours() * 100 + now.getMinutes();
            
            const todayPeriods = openingHours.periods.filter(period => 
                period.open && period.open.day === currentDay
            );
            
            for (const period of todayPeriods) {
                const openTime = period.open.hour * 100 + (period.open.minute || 0);
                const closeTime = period.close ? 
                    period.close.hour * 100 + (period.close.minute || 0) : 2400;
                
                if (currentTime >= openTime && currentTime < closeTime) {
                    return true;
                }
            }
            
            return false;
        }
        
        // ä¾¡æ ¼ãƒ¬ãƒ™ãƒ«ã‚’å†…éƒ¨å½¢å¼ã«å¤‰æ› (New APIå¯¾å¿œ)
        function convertPriceLevelNew(priceLevel) {
            switch(priceLevel) {
                case 'PRICE_LEVEL_FREE':
                case 'PRICE_LEVEL_INEXPENSIVE':
                    return '~5000';
                case 'PRICE_LEVEL_MODERATE':
                    return '5000-10000';
                case 'PRICE_LEVEL_EXPENSIVE':
                case 'PRICE_LEVEL_VERY_EXPENSIVE':
                    return '10000+';
                default:
                    return '~5000';
            }
        }
        
        // ç®¡ç†æ©Ÿèƒ½: æ–°åº—èˆ—ã®è‡ªå‹•è¿½åŠ  (New APIå¯¾å¿œ)
        async function addNewRestaurantAuto() {
            const storeName = prompt('åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: å…«æ–¹ç¾èœã€ãƒ”ãƒƒã‚³ãƒ­ã‚·ãƒãƒªã‚¢ï¼‰');
            if (!storeName) return;
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            const loadingMsg = document.createElement('div');
            loadingMsg.id = 'loading';
            loadingMsg.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 2000; text-align: center;
            `;
            loadingMsg.innerHTML = `
                <div style="font-size: 1.2rem; margin-bottom: 10px;">ğŸ“ åº—èˆ—æƒ…å ±ã‚’å–å¾—ä¸­...</div>
                <div style="color: #666;">${storeName}</div>
                <div style="font-size: 0.9rem; color: #999; margin-top: 10px;">New Places API ä½¿ç”¨</div>
            `;
            document.body.appendChild(loadingMsg);
            
            try {
                // New Places API ã§åº—èˆ—æƒ…å ±ã‚’è‡ªå‹•å–å¾—
                const placeData = await searchAndFetchPlaceInfo(storeName);
                
                if (placeData) {
                    // å–å¾—ã—ãŸæƒ…å ±ã§æ–°ã—ã„åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
                    const newId = restaurantData.length + 1;
                    const newRestaurant = {
                        id: newId,
                        name: placeData.name,
                        category: "ãã®ä»–", // æ‰‹å‹•ã§è¨­å®šãŒå¿…è¦
                        subcategory: "è¦åˆ†é¡",
                        address: placeData.address,
                        priceRange: convertPriceLevelNew(placeData.priceLevel),
                        volume: "ã—ã£ã‹ã‚Š", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                        orderStyle: "ã‚¢ãƒ©ã‚«ãƒ«ãƒˆ", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                        parking: "è¦ç¢ºèª",
                        access: "è¦ç¢ºèª",
                        hours: placeData.hours,
                        closed: "è¦ç¢ºèª",
                        phone: placeData.phone,
                        website: placeData.website,
                        instagram: "", // æ‰‹å‹•å…¥åŠ›ãŒå¿…è¦
                        googleMaps: placeData.googleMaps,
                        memo: "New Places APIã«ã‚ˆã‚Šè‡ªå‹•å–å¾—ã€‚è©³ç´°ã¯è¦ç¢ºèªã€‚",
                        tags: ["æ–°è¦è¿½åŠ ", "è¦ç¢ºèª"],
                        photos: placeData.photos.map(url => `è‡ªå‹•å–å¾—: ${url}`),
                        visited: false,
                        isOpen: placeData.isOpen,
                        // æ–°æ©Ÿèƒ½
                        wheelchairAccessible: placeData.wheelchairAccessible,
                        allowsDogs: placeData.allowsDogs,
                        paymentOptions: placeData.paymentOptions
                    };
                    
                    // ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ 
                    restaurantData.push(newRestaurant);
                    filteredData = [...restaurantData];
                    
                    // è¡¨ç¤ºæ›´æ–°
                    renderView();
                    
                    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (æ–°æ©Ÿèƒ½æƒ…å ±ã‚‚å«ã‚ã‚‹)
                    let successMessage = `âœ… ${placeData.name} ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼\n\nå–å¾—ã—ãŸæƒ…å ±ï¼š\nãƒ»ä½æ‰€: ${placeData.address}\nãƒ»é›»è©±: ${placeData.phone}\nãƒ»å–¶æ¥­æ™‚é–“: ${placeData.hours}`;
                    
                    if (placeData.wheelchairAccessible) {
                        successMessage += '\nãƒ»ãƒãƒªã‚¢ãƒ•ãƒªãƒ¼: å¯¾å¿œ';
                    }
                    if (placeData.allowsDogs) {
                        successMessage += '\nãƒ»ãƒšãƒƒãƒˆåŒä¼´: å¯èƒ½';
                    }
                    
                    successMessage += '\n\nâ€»ã‚«ãƒ†ã‚´ãƒªã‚„Instagramãªã©ä¸€éƒ¨æƒ…å ±ã¯æ‰‹å‹•ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚';
                    
                    alert(successMessage);
                }
                
            } catch (error) {
                alert('âŒ åº—èˆ—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§è¿½åŠ ã—ã¦ãã ã•ã„ã€‚');
                console.error(error);
            } finally {
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å‰Šé™¤
                const loading = document.getElementById('loading');
                if (loading) loading.remove();
            }
        }
        
        // æ—¢å­˜åº—èˆ—ã®æƒ…å ±ã‚’è‡ªå‹•æ›´æ–° (New APIå¯¾å¿œ)
        async function updateRestaurantInfo(restaurantId) {
            const restaurant = restaurantData.find(r => r.id === restaurantId);
            if (!restaurant) return;
            
            if (!confirm(`${restaurant.name} ã®æƒ…å ±ã‚’æœ€æ–°æƒ…å ±ã«æ›´æ–°ã—ã¾ã™ã‹ï¼Ÿ\n(New Places APIä½¿ç”¨)`)) return;
            
            try {
                const placeData = await searchAndFetchPlaceInfo(restaurant.name);
                
                if (placeData) {
                    // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ï¼ˆæ‰‹å‹•è¨­å®šé …ç›®ã¯ä¿æŒï¼‰
                    restaurant.address = placeData.address;
                    restaurant.phone = placeData.phone;
                    restaurant.hours = placeData.hours;
                    restaurant.website = placeData.website || restaurant.website;
                    restaurant.googleMaps = placeData.googleMaps;
                    restaurant.isOpen = placeData.isOpen;
                    restaurant.wheelchairAccessible = placeData.wheelchairAccessible;
                    restaurant.allowsDogs = placeData.allowsDogs;
                    restaurant.paymentOptions = placeData.paymentOptions;
                    
                    // æ–°ã—ã„å†™çœŸãŒã‚ã‚Œã°è¿½åŠ 
                    if (placeData.photos.length > 0) {
                        restaurant.photos = [...restaurant.photos, ...placeData.photos.map(url => `æ›´æ–°: ${url}`)];
                    }
                    
                    renderView();
                    alert(`âœ… ${restaurant.name} ã®æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼\n(New Places APIä½¿ç”¨)`);
                }
                
            } catch (error) {
                alert('âŒ æƒ…å ±æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                console.error(error);
            }
        }
        
        // å…¨åº—èˆ—ã®å–¶æ¥­æ™‚é–“ã‚’ä¸€æ‹¬æ›´æ–° (New APIå¯¾å¿œ)
        async function updateAllBusinessHours() {
            if (!confirm('å…¨åº—èˆ—ã®å–¶æ¥­æ™‚é–“ãƒ»å–¶æ¥­çŠ¶æ³ã‚’æ›´æ–°ã—ã¾ã™ã‹ï¼Ÿ\n(New Places APIä½¿ç”¨ãƒ»æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™)')) return;
            
            const progressDiv = document.createElement('div');
            progressDiv.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 2000; text-align: center; min-width: 300px;
            `;
            document.body.appendChild(progressDiv);
            
            let updated = 0;
            const total = restaurantData.length;
            
            for (let i = 0; i < restaurantData.length; i++) {
                const restaurant = restaurantData[i];
                progressDiv.innerHTML = `
                    <div style="font-size: 1.1rem; margin-bottom: 10px;">ğŸ”„ å–¶æ¥­æ™‚é–“æ›´æ–°ä¸­...</div>
                    <div>${restaurant.name}</div>
                    <div style="margin: 10px 0; background: #f0f0f0; border-radius: 10px; overflow: hidden;">
                        <div style="background: #DAA520; height: 10px; width: ${(i / total) * 100}%;"></div>
                    </div>
                    <div style="color: #666;">${i + 1} / ${total}</div>
                    <div style="font-size: 0.8rem; color: #999;">New Places API</div>
                `;
                
                try {
                    const placeData = await searchAndFetchPlaceInfo(restaurant.name);
                    if (placeData) {
                        restaurant.hours = placeData.hours;
                        restaurant.isOpen = placeData.isOpen;
                        restaurant.wheelchairAccessible = placeData.wheelchairAccessible;
                        restaurant.allowsDogs = placeData.allowsDogs;
                        updated++;
                    }
                    
                    // APIåˆ¶é™å¯¾ç­–ã§å°‘ã—å¾…æ©Ÿ
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                } catch (error) {
                    console.error(`${restaurant.name}ã®æ›´æ–°ã«å¤±æ•—:`, error);
                }
            }
            
            progressDiv.remove();
            renderView();
            alert(`âœ… ${updated}åº—èˆ—ã®å–¶æ¥­æ™‚é–“ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼\n(New Places APIä½¿ç”¨)`);
        }

        // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå®Ÿè£…ä¾‹ (New Places APIå¯¾å¿œ)
        /*
        // Node.js + Express ã§ã®å®Ÿè£…ä¾‹
        app.post('/api/places/searchText', async (req, res) => {
            const { searchData, apiKey } = req.body;
            
            try {
                const response = await axios.post(
                    'https://places.googleapis.com/v1/places:searchText',
                    searchData,
                    {
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Goog-Api-Key': apiKey,
                            'X-Goog-FieldMask': 'places.id,places.displayName,places.formattedAddress'
                        }
                    }
                );
                
                res.json(response.data);
            } catch (error) {
                res.status(500).json({ error: error.message });
            }
        });
        
        app.post('/api/places/details', async (req, res) => {
            const { placeId, fieldMask, apiKey } = req.body;
            
            try {
                const response = await axios.get(
                    `https://places.googleapis.com/v1/places/${placeId}`,
                    {
                        headers: {
                            'X-Goog-Api-Key': apiKey,
                            'X-Goog-FieldMask': fieldMask
                        }
                    }
                );
                
                res.json(response.data);
            } catch (error) {
                res.status(500).json({ error: error.message });
            }
        });
        */
        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ - å§«è·¯ã®å¤œã®ãŠåº—
        const restaurantData = [
            {
                id: 1,
                name: "ã†ã©ã‚“å±‹ã°ã",
                category: "ç´”å’Œé£Ÿ",
                subcategory: "ã†ã©ã‚“",
                address: "å§«è·¯å¸‚å†…",
                priceRange: "~5000",
                volume: "ã—ã£ã‹ã‚Š",
                orderStyle: "ã‚¢ãƒ©ã‚«ãƒ«ãƒˆ",
                parking: "æœ‰ã‚Šï¼ˆ10å°ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰å¾’æ­©15åˆ†",
                hours: "11:00-21:00",
                closed: "ç«æ›œæ—¥",
                phone: "079-XXX-XXXX",
                website: "",
                instagram: "",
                googleMaps: "",
                memo: "ã‚³ã‚·ã®ã‚ã‚‹æ‰‹æ‰“ã¡ã†ã©ã‚“ãŒè‡ªæ…¢ã€‚å‡ºæ±ãŒçµ¶å“ã€‚",
                tags: ["ã†ã©ã‚“", "æ‰‹æ‰“ã¡", "å‡ºæ±", "é§…è¿‘"],
                photos: [],
                visited: false,
                isOpen: true
            },
            {
                id: 2,
                name: "å…«æ–¹ç¾èœ",
                category: "æ´‹é£Ÿ",
                subcategory: "ã‚¤ã‚¿ãƒªã‚¢ãƒ³",
                address: "å…µåº«çœŒå§«è·¯å¸‚æœ¬ç”º68",
                priceRange: "5000-10000",
                volume: "ã—ã£ã‹ã‚Š",
                orderStyle: "ã‚³ãƒ¼ã‚¹",
                parking: "ç„¡ã—ï¼ˆè¿‘éš£ã‚³ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚­ãƒ³ã‚°åˆ©ç”¨ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰å¾’æ­©8åˆ†",
                hours: "18:00-22:00",
                closed: "æ—¥æ›œæ—¥ãƒ»æœˆæ›œæ—¥",
                phone: "079-289-4514",
                website: "https://www.instagram.com/happobina/",
                instagram: "https://www.instagram.com/happobina/",
                googleMaps: "https://maps.app.goo.gl/CtH8rXbfD6M7vGLe7",
                memo: "ãƒ‘ã‚¹ã‚¿ã‚„ãƒªã‚¾ãƒƒãƒˆãŒçµ¶å“ã€‚ã‚·ã‚§ãƒ•ã®æŠ€è¡“ãŒå…‰ã‚‹éš ã‚Œå®¶çš„ååº—ã€‚",
                tags: ["ã‚¤ã‚¿ãƒªã‚¢ãƒ³", "ãƒ‘ã‚¹ã‚¿", "ãƒªã‚¾ãƒƒãƒˆ", "éš ã‚Œå®¶", "æŠ€è¡“"],
                photos: [],
                visited: false,
                isOpen: true,
                article: "https://madamefigaro.jp/lifestyle/gourmet/230120-hyogo.html"
            },
            {
                id: 3,
                name: "ãƒ”ãƒƒã‚³ãƒ­ã‚·ãƒãƒªã‚¢",
                category: "æ´‹é£Ÿ",
                subcategory: "ã‚¤ã‚¿ãƒªã‚¢ãƒ³",
                address: "å…µåº«çœŒå§«è·¯å¸‚èŠ±ç”°ç”ºä¸ŠåŸç”°å­—ä¸‹ä¸­ç­‹1128-1",
                priceRange: "5000-10000",
                volume: "ã—ã£ã‹ã‚Š",
                orderStyle: "ã‚³ãƒ¼ã‚¹",
                parking: "æœ‰ã‚Šï¼ˆ10å°ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰è»Šã§15åˆ†",
                hours: "18:00-23:00",
                closed: "æœˆæ›œæ—¥",
                phone: "079-253-3939",
                website: "https://piccola-sicilia.com/",
                instagram: "https://www.instagram.com/piccola_sicilia_himeji/",
                googleMaps: "https://maps.app.goo.gl/QzXe7Rb2vEm9Y3wh6",
                memo: "æœ¬æ ¼çš„ãªã‚·ãƒãƒªã‚¢æ–™ç†ã€‚ã‚·ã‚§ãƒ•ã®ã“ã ã‚ã‚ŠãŒå…‰ã‚‹ã€‚",
                tags: ["ã‚¤ã‚¿ãƒªã‚¢ãƒ³", "ã‚·ãƒãƒªã‚¢", "ã‚³ãƒ¼ã‚¹", "æœ¬æ ¼"],
                photos: [],
                visited: false,
                isOpen: true,
                article: "https://madamefigaro.jp/lifestyle/gourmet/230120-hyogo.html"
            },
            {
                id: 4,
                name: "ç¦ç”°è‘¡è„é…’åº—",
                category: "æ´‹é£Ÿ",
                subcategory: "ãƒ•ãƒ¬ãƒ³ãƒ",
                address: "å…µåº«çœŒå§«è·¯å¸‚å‘‰æœç”º47",
                priceRange: "10000+",
                volume: "ã—ã£ã‹ã‚Š",
                orderStyle: "ã‚³ãƒ¼ã‚¹",
                parking: "ç„¡ã—ï¼ˆè¿‘éš£ã‚³ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚­ãƒ³ã‚°åˆ©ç”¨ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰å¾’æ­©12åˆ†",
                hours: "18:00-22:00",
                closed: "æ—¥æ›œæ—¥ãƒ»æœˆæ›œæ—¥",
                phone: "079-224-1192",
                website: "https://fukuda-wine.com/",
                instagram: "https://www.instagram.com/fukuda_wine_store/",
                googleMaps: "https://maps.app.goo.gl/VzKpMn4dLw8sT6eK8",
                memo: "ãƒ¯ã‚¤ãƒ³ã¨æ–™ç†ã®ãƒšã‚¢ãƒªãƒ³ã‚°ãŒç´ æ™´ã‚‰ã—ã„ã€‚",
                tags: ["ãƒ•ãƒ¬ãƒ³ãƒ", "ãƒ¯ã‚¤ãƒ³", "ãƒšã‚¢ãƒªãƒ³ã‚°", "é«˜ç´š"],
                photos: [],
                visited: false,
                isOpen: true
            },
            {
                id: 5,
                name: "ã‚¨ã‚°ãƒ¬ãƒƒãƒˆ",
                category: "æ´‹é£Ÿ",
                subcategory: "ãƒ•ãƒ¥ãƒ¼ã‚¸ãƒ§ãƒ³",
                address: "å…µåº«çœŒå§«è·¯å¸‚é§…å‰ç”º241",
                priceRange: "5000-10000",
                volume: "ã—ã£ã‹ã‚Š",
                orderStyle: "ã‚¢ãƒ©ã‚«ãƒ«ãƒˆ",
                parking: "ç„¡ã—ï¼ˆè¿‘éš£ã‚³ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚­ãƒ³ã‚°åˆ©ç”¨ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰å¾’æ­©3åˆ†",
                hours: "17:30-24:00",
                closed: "ä¸å®šä¼‘",
                phone: "079-284-5558",
                website: "https://aigrette-himeji.com/",
                instagram: "https://www.instagram.com/aigrette_himeji/",
                googleMaps: "https://maps.app.goo.gl/HzKp8qR2nF9wV5eA9",
                memo: "å‰µä½œæ–™ç†ã¨ã‚¯ãƒ©ãƒ•ãƒˆãƒ“ãƒ¼ãƒ«ãŒæ¥½ã—ã‚ã‚‹ã€‚",
                tags: ["ãƒ•ãƒ¥ãƒ¼ã‚¸ãƒ§ãƒ³", "å‰µä½œ", "ã‚¯ãƒ©ãƒ•ãƒˆãƒ“ãƒ¼ãƒ«", "é§…è¿‘"],
                photos: [],
                visited: false,
                isOpen: true
            },
            {
                id: 6,
                name: "ç´…é¶´",
                category: "ä¸­è¯",
                subcategory: "ä¸­è¯å…¨èˆ¬",
                address: "å…µåº«çœŒå§«è·¯å¸‚æœ¬ç”º68",
                priceRange: "5000-10000",
                volume: "ã—ã£ã‹ã‚Š",
                orderStyle: "ã‚¢ãƒ©ã‚«ãƒ«ãƒˆ",
                parking: "ç„¡ã—ï¼ˆè¿‘éš£ã‚³ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚­ãƒ³ã‚°åˆ©ç”¨ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰å¾’æ­©8åˆ†",
                hours: "11:30-14:30, 17:30-21:30",
                closed: "ç«æ›œæ—¥",
                phone: "079-222-8765",
                website: "https://kouzuru-himeji.com/",
                instagram: "https://www.instagram.com/kouzuru_himeji/",
                googleMaps: "https://maps.app.goo.gl/RY5msbeKvUR6zVN76",
                memo: "å§«è·¯åŸè¿‘ãã®è€èˆ—ä¸­è¯æ–™ç†åº—ã€‚ä¼çµ±ã¨é©æ–°ãŒèåˆã—ãŸå‘³ã‚ã„ã€‚",
                tags: ["ä¸­è¯", "è€èˆ—", "å§«è·¯åŸè¿‘ã", "ä¼çµ±"],
                photos: [],
                visited: false,
                isOpen: true
            },
            {
                id: 7,
                name: "ä¸­è¯æ–™ç† é¾ç‹",
                category: "ä¸­è¯",
                subcategory: "ä¸­è¯å…¨èˆ¬",
                address: "å…µåº«çœŒå§«è·¯å¸‚é£¾ç£¨åŒºä»Šåœ¨å®¶1234-5",
                priceRange: "~5000",
                volume: "ã—ã£ã‹ã‚Š",
                orderStyle: "ã‚¢ãƒ©ã‚«ãƒ«ãƒˆ",
                parking: "æœ‰ã‚Šï¼ˆ15å°ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰è»Šã§12åˆ†",
                hours: "11:30-14:30, 17:30-22:00",
                closed: "æœ¨æ›œæ—¥",
                phone: "079-235-XXXX",
                website: "https://ryuuou-chinese.com/",
                instagram: "https://www.instagram.com/ryuuou_chinese/",
                googleMaps: "https://maps.app.goo.gl/AbCd3fGhIjKlMnOp4",
                memo: "æœ¬æ ¼çš„ãªä¸­è¯æ–™ç†ã€‚ç‰¹ã«éº»å©†è±†è…ãŒçµ¶å“ã€‚",
                tags: ["ä¸­è¯", "éº»å©†è±†è…", "æœ¬æ ¼", "é§è»Šå ´"],
                photos: [],
                visited: false,
                isOpen: true
            },
            {
                id: 8,
                name: "ã‚¿ã‚¤æ–™ç† ãƒãƒ³ã‚³ã‚¯",
                category: "ã‚¢ã‚¸ã‚¢æ–™ç†",
                subcategory: "ã‚¿ã‚¤æ–™ç†",
                address: "å…µåº«çœŒå§«è·¯å¸‚åŒ—æ¡å£2-56",
                priceRange: "~5000",
                volume: "è»½ã‚",
                orderStyle: "ã‚¢ãƒ©ã‚«ãƒ«ãƒˆ",
                parking: "æœ‰ã‚Šï¼ˆ8å°ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰å¾’æ­©20åˆ†",
                hours: "11:30-14:00, 17:30-22:30",
                closed: "æœˆæ›œæ—¥",
                phone: "079-224-XXXX",
                website: "https://bangkok-thai.jp/",
                instagram: "https://www.instagram.com/bangkok_thai_himeji/",
                googleMaps: "https://maps.app.goo.gl/QrSt7uVwXyZ1AbCd9",
                memo: "æœ¬å ´ã®å‘³ãŒæ¥½ã—ã‚ã‚‹ã€‚ãƒˆãƒ ãƒ¤ãƒ ã‚¯ãƒ³ãŒäººæ°—ã€‚",
                tags: ["ã‚¿ã‚¤æ–™ç†", "ãƒˆãƒ ãƒ¤ãƒ ã‚¯ãƒ³", "æœ¬å ´", "ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼"],
                photos: [],
                visited: false,
                isOpen: true
            },
            {
                id: 9,
                name: "ãã°å‡¦ å§«è·¯åºµ",
                category: "ç´”å’Œé£Ÿ",
                subcategory: "ãã°",
                address: "å…µåº«çœŒå§«è·¯å¸‚åºƒç•‘åŒºè¥¿å¤¢å‰å°5-123",
                priceRange: "~5000",
                volume: "è»½ã‚",
                orderStyle: "ã‚¢ãƒ©ã‚«ãƒ«ãƒˆ",
                parking: "æœ‰ã‚Šï¼ˆ6å°ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰è»Šã§20åˆ†",
                hours: "11:00-15:00, 17:00-21:00",
                closed: "æ°´æ›œæ—¥",
                phone: "079-266-XXXX",
                website: "https://himeji-an.com/",
                instagram: "https://www.instagram.com/himeji_an/",
                googleMaps: "https://maps.app.goo.gl/EfGh4iJkLmNoPqRs8",
                memo: "æ‰‹æ‰“ã¡ãã°ã¨å­£ç¯€ã®å¤©ã·ã‚‰ãŒç¾å‘³ã—ã„ã€‚",
                tags: ["ãã°", "æ‰‹æ‰“ã¡", "å¤©ã·ã‚‰", "å­£ç¯€"],
                photos: [],
                visited: false,
                isOpen: true
            },
            {
                id: 10,
                name: "å±…é…’å±‹ ç“¢ç®ª",
                category: "å’Œé£Ÿ",
                subcategory: "å±…é…’å±‹",
                address: "å…µåº«çœŒå§«è·¯å¸‚é§…å‰ç”º188",
                priceRange: "~5000",
                volume: "ã—ã£ã‹ã‚Š",
                orderStyle: "ã‚¢ãƒ©ã‚«ãƒ«ãƒˆ",
                parking: "ç„¡ã—ï¼ˆè¿‘éš£ã‚³ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚­ãƒ³ã‚°åˆ©ç”¨ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰å¾’æ­©3åˆ†",
                hours: "17:00-24:00",
                closed: "æ—¥æ›œæ—¥",
                phone: "079-222-XXXX",
                website: "https://hyotan-izakaya.com/",
                instagram: "https://www.instagram.com/hyotan_izakaya/",
                googleMaps: "https://maps.app.goo.gl/TuVw9xYzAb2cDeFg1",
                memo: "åœ°å…ƒã®å¸¸é€£ã•ã‚“ã§è³‘ã‚ã†éš ã‚Œå®¶çš„å±…é…’å±‹ã€‚",
                tags: ["å±…é…’å±‹", "åœ°å…ƒ", "éš ã‚Œå®¶", "é§…è¿‘"],
                photos: [],
                visited: false,
                isOpen: true
            },
            {
                id: 11,
                name: "ã‚¹ãƒ†ãƒ¼ã‚­ãƒã‚¦ã‚¹ ä½†é¦¬",
                category: "æ´‹é£Ÿ",
                subcategory: "ã‚¹ãƒ†ãƒ¼ã‚­",
                address: "å…µåº«çœŒå§«è·¯å¸‚ç™½æµœç”ºç”²841",
                priceRange: "10000+",
                volume: "ã—ã£ã‹ã‚Š",
                orderStyle: "ã‚³ãƒ¼ã‚¹",
                parking: "æœ‰ã‚Šï¼ˆ12å°ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰è»Šã§18åˆ†",
                hours: "17:30-22:00",
                closed: "ç«æ›œæ—¥",
                phone: "079-245-XXXX",
                website: "https://tajima-steak.com/",
                instagram: "https://www.instagram.com/tajima_steakhouse/",
                googleMaps: "https://maps.app.goo.gl/GhIj5kLmNoP6qRsT2",
                memo: "ä½†é¦¬ç‰›ã‚’ä½¿ã£ãŸæ¥µä¸Šã®ã‚¹ãƒ†ãƒ¼ã‚­ãŒå‘³ã‚ãˆã‚‹ã€‚",
                tags: ["ã‚¹ãƒ†ãƒ¼ã‚­", "ä½†é¦¬ç‰›", "é«˜ç´š", "æ¥µä¸Š"],
                photos: [],
                visited: false,
                isOpen: true
            },
            {
                id: 12,
                name: "ã‚¤ãƒ³ãƒ‰æ–™ç† ã‚¬ãƒ³ã‚¬ãƒ¼",
                category: "ã‚¢ã‚¸ã‚¢æ–™ç†",
                subcategory: "ã‚¤ãƒ³ãƒ‰æ–™ç†",
                address: "å…µåº«çœŒå§«è·¯å¸‚ä»Šå®¿1-4-15",
                priceRange: "~5000",
                volume: "ã—ã£ã‹ã‚Š",
                orderStyle: "ã‚¢ãƒ©ã‚«ãƒ«ãƒˆ",
                parking: "æœ‰ã‚Šï¼ˆ10å°ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰è»Šã§14åˆ†",
                hours: "11:30-14:30, 17:30-22:30",
                closed: "ãªã—",
                phone: "079-297-XXXX",
                website: "https://ganga-indian.com/",
                instagram: "https://www.instagram.com/ganga_indian_himeji/",
                googleMaps: "https://maps.app.goo.gl/UvWx7yZaB8cDeF9h3",
                memo: "æœ¬æ ¼çš„ãªã‚¤ãƒ³ãƒ‰ã‚«ãƒ¬ãƒ¼ã¨ãƒŠãƒ³ãŒçµ¶å“ã€‚",
                tags: ["ã‚¤ãƒ³ãƒ‰æ–™ç†", "ã‚«ãƒ¬ãƒ¼", "ãƒŠãƒ³", "æœ¬æ ¼"],
                photos: [],
                visited: false,
                isOpen: true
            },
            {
                id: 13,
                name: "ãŠå¥½ã¿ç„¼ã ã¿ã£ã¡ã‚ƒã‚“",
                category: "å’Œé£Ÿ",
                subcategory: "ç²‰ç‰©",
                address: "å…µåº«çœŒå§«è·¯å¸‚é­šç”º96",
                priceRange: "~5000",
                volume: "ã—ã£ã‹ã‚Š",
                orderStyle: "ã‚¢ãƒ©ã‚«ãƒ«ãƒˆ",
                parking: "ç„¡ã—ï¼ˆè¿‘éš£ã‚³ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚­ãƒ³ã‚°åˆ©ç”¨ï¼‰",
                access: "å§«è·¯é§…ã‹ã‚‰å¾’æ­©10åˆ†",
                hours: "17:00-23:00",
                closed: "æœˆæ›œæ—¥",
                phone: "079-223-XXXX",
                website: "https://mitchan-okonomiyaki.com/",
                instagram: "https://www.instagram.com/mitchan_okonomiyaki/",
                googleMaps: "https://maps.app.goo.gl/YzAb4cDeFg7hIjKl5",
                memo: "æ˜”ãªãŒã‚‰ã®é–¢è¥¿é¢¨ãŠå¥½ã¿ç„¼ãã€‚ã‚½ãƒ¼ã‚¹ãŒè‡ªå®¶è£½ã€‚",
                tags: ["ãŠå¥½ã¿ç„¼ã", "é–¢è¥¿é¢¨", "è‡ªå®¶è£½ã‚½ãƒ¼ã‚¹", "æ˜”ãªãŒã‚‰"],
                photos: [],
                visited: false,
                isOpen: false // ä¼‘æ—¥ã®ä¾‹
            }
        ];

        let filteredData = [...restaurantData];
        let currentView = 'gallery';
        let visitedRestaurants = new Set();
        let uploadedPhotos = [];

        // ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
        function init() {
            loadVisitedData();
            renderView();
            setupEventListeners();
            updateStats();
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            document.getElementById('cuisineFilter').addEventListener('change', applyFilters);
            document.getElementById('priceFilter').addEventListener('change', applyFilters);
            document.getElementById('volumeFilter').addEventListener('change', applyFilters);
            document.getElementById('searchInput').addEventListener('input', applyFilters);
        }

        // è¨ªå•ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadVisitedData() {
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰èª­ã¿è¾¼ã¿
            // ã“ã“ã§ã¯ãƒ¡ãƒ¢ãƒªå†…ã§ç®¡ç†
        }

        // ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
        function renderView() {
            if (currentView === 'gallery') {
                renderGallery();
            } else {
                renderList();
            }
        }

        // ã‚®ãƒ£ãƒ©ãƒªãƒ¼è¡¨ç¤º
        function renderGallery() {
            const gallery = document.getElementById('gallery');
            gallery.style.display = 'grid';
            document.getElementById('listView').style.display = 'none';
            
            gallery.innerHTML = '';
            filteredData.forEach(item => {
                const card = createCard(item);
                gallery.appendChild(card);
            });
        }

        // ãƒªã‚¹ãƒˆè¡¨ç¤º
        function renderList() {
            document.getElementById('gallery').style.display = 'none';
            const listView = document.getElementById('listView');
            listView.style.display = 'block';
            
            const tbody = document.getElementById('listTableBody');
            tbody.innerHTML = '';
            
            filteredData.forEach(item => {
                const row = createListRow(item);
                tbody.appendChild(row);
            });
        }

        // ã‚«ãƒ¼ãƒ‰ä½œæˆ
        function createCard(item) {
            const card = document.createElement('div');
            card.className = `card ${!item.isOpen ? 'closed' : ''}`;
            
            const visitedBadge = visitedRestaurants.has(item.id) ? '<span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 8px; font-size: 0.8rem;">è¡Œã£ãŸ!</span>' : '';
            
            card.innerHTML = `
                <div class="card-header">
                    <div>
                        <div class="card-title">${item.name} ${visitedBadge}</div>
                        <div class="card-address">${item.address}</div>
                    </div>
                    <div class="card-type">${item.subcategory}</div>
                </div>
                <div class="tags">
                    ${item.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
                <div class="card-info">
                    <div class="info-item">
                        <div class="info-label">é‡‘é¡å¸¯</div>
                        <div class="info-value">${getPriceLabel(item.priceRange)}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">é‡</div>
                        <div class="info-value">${item.volume}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ã‚¢ã‚¯ã‚»ã‚¹</div>
                        <div class="info-value">${item.access}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">å–¶æ¥­æ™‚é–“</div>
                        <div class="info-value">${item.hours}</div>
                    </div>
                </div>
                <div class="card-actions">
                    <button class="btn btn-primary btn-small" onclick="showDetail(${item.id})">è©³ç´°ã‚’è¦‹ã‚‹</button>
                    <button class="btn btn-secondary btn-small" onclick="showOnMap(${item.id})">å ´æ‰€ã‚’ã¿ã‚‹</button>
                    <button class="btn btn-secondary btn-small" onclick="markAsVisited(${item.id})">${visitedRestaurants.has(item.id) ? 'è¡Œã£ãŸè¨˜éŒ²å‰Šé™¤' : 'è¡Œã£ãŸ!'}</button>
                </div>
            `;
            return card;
        }

        // ãƒªã‚¹ãƒˆè¡Œä½œæˆ
        function createListRow(item) {
            const row = document.createElement('tr');
            row.className = !item.isOpen ? 'closed' : '';
            
            const visitedBadge = visitedRestaurants.has(item.id) ? 'âœ“' : '';
            
            row.innerHTML = `
                <td>${item.name} ${visitedBadge}</td>
                <td>${item.subcategory}</td>
                <td>${getPriceLabel(item.priceRange)}</td>
                <td>${item.access}</td>
                <td>${item.hours}</td>
                <td>${item.parking}</td>
                <td>
                    <button class="btn btn-primary btn-small" onclick="showDetail(${item.id})">è©³ç´°</button>
                    <button class="btn btn-secondary btn-small" onclick="showOnMap(${item.id})">å ´æ‰€</button>
                    <button class="btn btn-secondary btn-small" onclick="markAsVisited(${item.id})">${visitedRestaurants.has(item.id) ? 'å‰Šé™¤' : 'è¡Œã£ãŸ'}</button>
                </td>
            `;
            return row;
        }

        // é‡‘é¡ãƒ©ãƒ™ãƒ«å–å¾—
        function getPriceLabel(priceRange) {
            const labels = {
                '~5000': 'ã€œ5,000å††',
                '5000-10000': '5,000ã€œ10,000å††',
                '10000+': '10,000å††ã€œ'
            };
            return labels[priceRange] || priceRange;
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
        function applyFilters() {
            const cuisineFilter = document.getElementById('cuisineFilter').value;
            const priceFilter = document.getElementById('priceFilter').value;
            const volumeFilter = document.getElementById('volumeFilter').value;
            const searchText = document.getElementById('searchInput').value.toLowerCase();

            filteredData = restaurantData.filter(item => {
                if (cuisineFilter && item.category !== cuisineFilter) return false;
                if (priceFilter && item.priceRange !== priceFilter) return false;
                if (volumeFilter && item.volume !== volumeFilter) return false;

                if (searchText) {
                    const searchableText = `${item.name} ${item.subcategory} ${item.tags.join(' ')} ${item.memo}`.toLowerCase();
                    if (!searchableText.includes(searchText)) return false;
                }

                return true;
            });

            renderView();
            updateStats();
        }

        // è¨ªå•ãƒãƒ¼ã‚¯
        function markAsVisited(id) {
            if (visitedRestaurants.has(id)) {
                visitedRestaurants.delete(id);
            } else {
                visitedRestaurants.add(id);
            }
            renderView();
            updateStats();
        }

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStats() {
            // ãƒ‡ãƒ¼ã‚¿çµ±è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ãŸãŸã‚ã€ã“ã®é–¢æ•°ã¯ç©ºã«ã™ã‚‹
        }

        // è©³ç´°è¡¨ç¤º
        function showDetail(id) {
            const item = restaurantData.find(item => item.id === id);
            if (!item) return;

            document.getElementById('modalTitle').textContent = item.name;
            document.getElementById('modalBody').innerHTML = `
                <div class="detail-grid">
                    <div class="detail-section">
                        <h3>åŸºæœ¬æƒ…å ±</h3>
                        <div class="info-item">
                            <div class="info-label">ã‚¸ãƒ£ãƒ³ãƒ«</div>
                            <div class="info-value">${item.category} > ${item.subcategory}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ä½æ‰€</div>
                            <div class="info-value">${item.address}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">é›»è©±ç•ªå·</div>
                            <div class="info-value">${item.phone}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">å–¶æ¥­æ™‚é–“</div>
                            <div class="info-value">${item.hours}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">å®šä¼‘æ—¥</div>
                            <div class="info-value">${item.closed}</div>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>ã‚¢ã‚¯ã‚»ã‚¹ãƒ»äºˆç´„</h3>
                        <div class="info-item">
                            <div class="info-label">ã‚¢ã‚¯ã‚»ã‚¹</div>
                            <div class="info-value">${item.access}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">é§è»Šå ´</div>
                            <div class="info-value">${item.parking}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">é‡‘é¡å¸¯</div>
                            <div class="info-value">${getPriceLabel(item.priceRange)}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">é ¼ã¿æ–¹</div>
                            <div class="info-value">${item.orderStyle}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</div>
                            <div class="info-value">
                                ${item.website ? `<a href="${item.website}" target="_blank" style="color: #DAA520; text-decoration: none;">ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹</a>` : 'æƒ…å ±ãªã—'}
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Instagram</div>
                            <div class="info-value">
                                ${item.instagram ? `<a href="${item.instagram}" target="_blank" style="color: #DAA520; text-decoration: none;">@ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¦‹ã‚‹</a>` : 'æƒ…å ±ãªã—'}
                            </div>
                        </div>
                        ${item.article ? `
                        <div class="info-item">
                            <div class="info-label">ãŠã™ã™ã‚è¨˜äº‹</div>
                            <div class="info-value">
                                <a href="${item.article}" target="_blank" style="color: #DAA520; text-decoration: none;">Madame Figaroè¨˜äº‹</a>
                            </div>
                        </div>
                        ` : ''}
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="makeReservation(${item.id})">äºˆç´„ãƒ»ãŠå•ã„åˆã‚ã›</button>
                            <button class="btn btn-secondary" onclick="showOnMap(${item.id})" style="margin-left: 10px;">Google Mapã§è¦‹ã‚‹</button>
                            <button class="btn btn-secondary" onclick="updateRestaurantInfo(${item.id})" style="margin-left: 10px;">ğŸ”„ æƒ…å ±æ›´æ–°</button>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>å®¶è€ã®ãƒ¡ãƒ¢</h3>
                        <p>${item.memo}</p>
                        <div class="tags" style="margin-top: 16px;">
                            ${item.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>å†™çœŸãƒ»è¨˜éŒ²</h3>
                        <button class="btn btn-secondary" onclick="openPhotoModal(${item.id})" style="margin-bottom: 16px;">å†™çœŸã‚’æŠ•ç¨¿</button>
                        <div class="photos-grid">
                            ${item.photos.length > 0 ? 
                                item.photos.map(photo => `<div class="photo-item">${photo}</div>`).join('') :
                                '<div class="photo-item">å†™çœŸãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</div>'
                            }
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('detailModal').style.display = 'block';
        }

        // äºˆç´„ã‚·ã‚¹ãƒ†ãƒ 
        function makeReservation(id) {
            const item = restaurantData.find(item => item.id === id);
            if (!item) return;

            // é›»è©±ç•ªå·ã‚„äºˆç´„å°‚ç”¨LINEã«é·ç§»
            if (item.phone && item.phone !== '') {
                window.open(`tel:${item.phone}`, '_self');
            } else {
                alert('ãŠé›»è©±ã§ã®ã”äºˆç´„ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚');
            }
        }

        // å†™çœŸæŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ«
        function openPhotoModal(restaurantId) {
            window.currentRestaurantId = restaurantId;
            document.getElementById('photoModal').style.display = 'block';
        }

        function closePhotoModal() {
            document.getElementById('photoModal').style.display = 'none';
        }

        function uploadPhoto() {
            document.getElementById('photoInput').click();
        }

        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            const photoData = {
                id: uploadedPhotos.length + 1,
                restaurantId: window.currentRestaurantId,
                filename: file.name,
                timestamp: new Date()
            };

            uploadedPhotos.push(photoData);
            
            // è©²å½“ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã®å†™çœŸé…åˆ—ã«è¿½åŠ 
            const restaurant = restaurantData.find(r => r.id === window.currentRestaurantId);
            if (restaurant) {
                restaurant.photos.push(`ğŸ“¸ ${file.name}`);
            }

            updateStats();
            closePhotoModal();
            alert('å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼');
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        // CSVå‡ºåŠ›
        function exportVisited() {
            if (visitedRestaurants.size === 0) {
                alert('ã¾ã è¡Œã£ãŸåº—ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }

            const visitedData = restaurantData.filter(item => visitedRestaurants.has(item.id));
            const csvContent = convertToCSV(visitedData);
            downloadCSV(csvContent, 'è¡Œã£ãŸåº—ãƒªã‚¹ãƒˆ.csv');
        }

        // CSVå¤‰æ›
        function convertToCSV(data) {
            const headers = [
                'åº—å', 'ã‚¸ãƒ£ãƒ³ãƒ«', 'ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒª', 'ä½æ‰€', 'é‡‘é¡å¸¯', 'é‡', 'é ¼ã¿æ–¹',
                'ã‚¢ã‚¯ã‚»ã‚¹', 'å–¶æ¥­æ™‚é–“', 'å®šä¼‘æ—¥', 'é§è»Šå ´', 'é›»è©±ç•ªå·', 'ãƒ¡ãƒ¢'
            ];

            const rows = data.map(item => [
                item.name,
                item.category,
                item.subcategory,
                item.address,
                getPriceLabel(item.priceRange),
                item.volume,
                item.orderStyle,
                item.access,
                item.hours,
                item.closed,
                item.parking,
                item.phone,
                item.memo
            ]);

            return [headers, ...rows].map(row => 
                row.map(field => `"${field}"`).join(',')
            ).join('\n');
        }

        // CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadCSV(content, filename) {
            const blob = new Blob(['\uFEFF' + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // è¨˜éŒ²ã‚¯ãƒªã‚¢
        function clearVisited() {
            if (confirm('è¡Œã£ãŸåº—ã®è¨˜éŒ²ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                visitedRestaurants.clear();
                renderView();
                updateStats();
            }
        }

        // è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function setView(viewType) {
            const galleryBtn = document.getElementById('galleryBtn');
            const listBtn = document.getElementById('listBtn');
            
            galleryBtn.classList.remove('active');
            listBtn.classList.remove('active');
            
            if (viewType === 'gallery') {
                galleryBtn.classList.add('active');
                currentView = 'gallery';
            } else {
                listBtn.classList.add('active');
                currentView = 'list';
            }
            
            renderView();
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', init);

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        window.addEventListener('click', function(event) {
            const detailModal = document.getElementById('detailModal');
            const photoModal = document.getElementById('photoModal');
            
            if (event.target === detailModal) {
                closeModal();
            }
            if (event.target === photoModal) {
                closePhotoModal();
            }
        });
    </script>
</body>
</html>
